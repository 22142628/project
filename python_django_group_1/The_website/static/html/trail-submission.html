{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trail Submission Form</title>
    <link rel="stylesheet" href="projectC.css">
</head>
<body>
    <h2>Trail Submission Form</h2>
    <form id="trailForm" action="submit_trail.php" method="post" enctype="multipart/form-data" novalidate>
        
        <label for="trail_name">Trail Name *:</label>
        <input type="text" id="trail_name" name="trail_name">
        <div class="error-message" id="trail_name-error">Only letters, numbers, spaces and hyphens allowed</div>

        <label for="location">Location *:</label>
        <input type="text" id="location" name="location">
        <div class="error-message" id="location-error">Only letters, numbers, spaces and hyphens allowed</div>

        <label for="gps">GPS Coordinates (Optional):</label>
        <input type="text" id="gps" name="gps" placeholder="e.g., 37.7749, -122.4194">
        <div class="error-message" id="gps-error">Please enter valid coordinates in format: Latitude, Longitude (e.g., 37.7749, -122.4194)</div>

        <label for="start_end">Trail Start / End Point (Optional):</label>
        <input type="text" id="start_end" name="start_end" placeholder="Start/End">
        <div class="error-message" id="start_end-error">Only letters, numbers, spaces and hyphens allowed</div>

        <label for="distance">Distance (km) *:</label>
        <input type="text" id="distance" name="distance" placeholder="e.g., 5.2">
        <div class="error-message" id="distance-error">Please enter a positive number greater than zero</div>

        <label for="elevation">Elevation Gain (m) *:</label>
        <input type="text" id="elevation" name="elevation" placeholder="e.g., 150">
        <div class="error-message" id="elevation-error">Please enter a valid number</div>

        <label for="difficulty">Difficulty Level *:</label>
        <select id="difficulty" name="difficulty">
            <option value="" disabled selected hidden>Select an option</option>
            <option value="Beginner">Beginner</option>
            <option value="Intermediate">Intermediate</option>
            <option value="Advanced">Advanced</option>
        </select>
        <div class="error-message" id="difficulty-error">Please select a difficulty level</div>

        <label for="trail_type">Trail Type *:</label>
        <select id="trail_type" name="trail_type">
            <option value="" disabled selected hidden>Select an option</option>
            <option value="Loop">Loop</option>
            <option value="Out & Back">Out & Back</option>
            <option value="Point-to-Point">Point-to-Point</option>
        </select>
        <div class="error-message" id="trail_type-error">Please select a trail type</div>

        <label for="estimated_time">Estimated Time (hours) *:</label>
        <input type="text" id="estimated_time" name="estimated_time" placeholder="e.g., 2.5">
        <div class="error-message" id="estimated_time-error">Please enter a positive number greater than zero</div>

        <fieldset>
            <legend>Trail Conditions (Optional):</legend>
            <div class="checkbox-group">
                <label><input type="checkbox" name="conditions[]" value="Muddy"> Muddy</label>
                <label><input type="checkbox" name="conditions[]" value="Rocky"> Rocky</label>
                <label><input type="checkbox" name="conditions[]" value="Icy"> Icy</label>
                <label><input type="checkbox" name="conditions[]" value="Snowy"> Snowy</label>
                <label><input type="checkbox" name="conditions[]" value="Dry"> Dry</label>
                <label><input type="checkbox" name="conditions[]" value="Wet"> Wet</label>
                <label><input type="checkbox" name="conditions[]" value="Hilly"> Hilly</label>
                <label><input type="checkbox" name="conditions[]" value="Steep"> Steep</label>
            </div>
        </fieldset>

        <fieldset>
            <legend>Accessibility Information (Optional):</legend>
            <div class="checkbox-group">
                <label><input type="checkbox" name="accessibility[]" value="Wheelchair Accessible"> Wheelchair Accessible</label>
                <label><input type="checkbox" name="accessibility[]" value="Child-friendly"> Child-friendly</label>
                <label><input type="checkbox" name="accessibility[]" value="Dog-friendly"> Dog-friendly</label>
                <label><input type="checkbox" name="accessibility[]" value="Permit Required"> Permit Required</label>
            </div>
        </fieldset>

        <label for="hiker_biker">Hiker/Biker Friendly? *:</label>
        <select id="hiker_biker" name="hiker_biker">
            <option value="" disabled selected hidden>Select an option</option>
            <option value="Hiker">Hiker</option>
            <option value="Biker">Biker</option>
            <option value="Both">Both</option>
        </select>
        <div class="error-message" id="hiker_biker-error">Please select an option</div>

        <label for="completed_as">How did you complete the trail? *:</label>
        <select id="completed_as" name="completed_as">
            <option value="" disabled selected hidden>Select an option</option>
            <option value="Hiking">Hiking</option>
            <option value="Biking">Biking</option>
        </select>
        <div class="error-message" id="completed_as-error">Please select an option</div>

        <label for="photos">Upload Photos (Optional):</label>
        <input type="file" id="photos" name="photos[]" multiple accept="image/*">
        <div class="error-message" id="photos-error">Only image files are allowed (JPEG, PNG, GIF)</div>

        <label for="notes">User Notes (Optional):</label>
        <textarea id="notes" name="notes" rows="4"></textarea>
        <div class="error-message" id="notes-error">Only letters, numbers, spaces, periods, commas and hyphens allowed</div>

        <br>
        <button type="submit">Submit Report</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('trailForm');
            const validators = {
                
                textValidator: function(value) {
                    return /^[a-zA-Z0-9 \-]*$/.test(value);
                },
                
                
                gpsValidator: function(value) {
                    if (!value.trim()) return true;
                    
                    const gpsRegex = /^-?\d{1,3}(\.\d+)?,\s*-?\d{1,3}(\.\d+)?$/;
                    if (!gpsRegex.test(value)) return false;
                    
                    const [lat, lng] = value.split(',').map(coord => parseFloat(coord.trim()));
                    return (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180);
                },
                
              
                positiveNumberValidator: function(value) {
                    const num = parseFloat(value);
                    return !isNaN(num) && num > 0;
                },
                
                
                nonNegativeNumberValidator: function(value) {
                    const num = parseFloat(value);
                    return !isNaN(num) && num >= 0;
                },
                
                
                anyNumberValidator: function(value) {
                    const num = parseFloat(value);
                    return !isNaN(num);
                },
                
               
                requiredValidator: function(value) {
                    return value.trim() !== '';
                },
                
                
                notesValidator: function(value) {
                    if (!value.trim()) return true; 
                    return /^[a-zA-Z0-9 .,\-]*$/.test(value);
                },
                
                
                fileValidator: function(fileList) {
                    if (fileList.length === 0) return true; 
                    
                    const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
                    for (let i = 0; i < fileList.length; i++) {
                        if (!validTypes.includes(fileList[i].type)) {
                            return false;
                        }
                    }
                    return true;
                }
            };
            
            
            const fields = [
                { 
                    id: 'trail_name', 
                    validators: ['required', 'text'],
                    errorMessage: 'Only letters, numbers, spaces and hyphens allowed' 
                },
                { 
                    id: 'location', 
                    validators: ['required', 'text'],
                    errorMessage: 'Only letters, numbers, spaces and hyphens allowed' 
                },
                { 
                    id: 'gps', 
                    validators: ['gps'],
                    errorMessage: 'Please enter valid coordinates in format: Latitude, Longitude (e.g., 37.7749, -122.4194)' 
                },
                { 
                    id: 'start_end', 
                    validators: ['text'],
                    errorMessage: 'Only letters, numbers, spaces and hyphens allowed' 
                },
                { 
                    id: 'distance', 
                    validators: ['required', 'positiveNumber'],  
                    errorMessage: 'Please enter a positive number greater than zero' 
                },
                { 
                    id: 'elevation', 
                    validators: ['required', 'anyNumber'],
                    errorMessage: 'Please enter a valid number' 
                },
                { 
                    id: 'difficulty', 
                    validators: ['required'],
                    errorMessage: 'Please select a difficulty level' 
                },
                { 
                    id: 'trail_type', 
                    validators: ['required'],
                    errorMessage: 'Please select a trail type' 
                },
                { 
                    id: 'estimated_time', 
                    validators: ['required', 'positiveNumber'], 
                    errorMessage: 'Please enter a positive number greater than zero' 
                },
                { 
                    id: 'hiker_biker', 
                    validators: ['required'],
                    errorMessage: 'Please select an option' 
                },
                { 
                    id: 'completed_as', 
                    validators: ['required'],
                    errorMessage: 'Please select an option' 
                },
                { 
                    id: 'photos', 
                    validators: ['file'],
                    errorMessage: 'Only image files are allowed (JPEG, PNG, GIF)' 
                },
                { 
                    id: 'notes', 
                    validators: ['notes'],
                    errorMessage: 'Only letters, numbers, spaces, periods, commas and hyphens allowed' 
                }
            ];
            
        
            function validateField(field) {
                const element = document.getElementById(field.id);
                const errorElement = document.getElementById(`${field.id}-error`);
                let isValid = true;
                
               
                field.validators.forEach(validatorName => {
                    let value = element.value;
                    
                   
                    if (field.id === 'photos') {
                        value = element.files;
                    }
                    
            
                    let validatorResult = true;
                    switch(validatorName) {
                        case 'required':
                            validatorResult = validators.requiredValidator(value);
                            break;
                        case 'text':
                            validatorResult = validators.textValidator(value);
                            break;
                        case 'gps':
                            validatorResult = validators.gpsValidator(value);
                            break;
                        case 'number':
                            validatorResult = validators.nonNegativeNumberValidator(value);
                            break;
                        case 'positiveNumber': 
                            validatorResult = validators.positiveNumberValidator(value);
                            break;
                        case 'nonNegativeNumber':
                            validatorResult = validators.nonNegativeNumberValidator(value);
                            break;
                        case 'anyNumber':
                            validatorResult = validators.anyNumberValidator(value);
                            break;
                        case 'notes':
                            validatorResult = validators.notesValidator(value);
                            break;
                        case 'file':
                            validatorResult = validators.fileValidator(value);
                            break;
                    }
                    
                    if (!validatorResult) {
                        isValid = false;
                    }
                });
                
               
                if (!isValid) {
                    element.classList.add('error-border');
                    element.classList.remove('valid-border');
                    errorElement.style.display = 'block';
                    element.setAttribute('aria-invalid', 'true');
                } else {
                    element.classList.remove('error-border');
                    if (element.value.trim() !== '') {
                        element.classList.add('valid-border');
                    } else {
                        element.classList.remove('valid-border');
                    }
                    errorElement.style.display = 'none';
                    element.setAttribute('aria-invalid', 'false');
                }
                
                return isValid;
            }
            
            
            fields.forEach(field => {
                const element = document.getElementById(field.id);
                
               
                element.addEventListener('blur', function() {
                    validateField(field);
                });
                
                
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.addEventListener('input', function() {
                       
                        const errorElement = document.getElementById(`${field.id}-error`);
                        element.classList.remove('error-border');
                        errorElement.style.display = 'none';
                    });
                }
                
                if (element.tagName === 'SELECT') {
                    element.addEventListener('change', function() {
                        validateField(field);
                    });
                }
            });
            
        
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                let isFormValid = true;
                
                
                fields.forEach(field => {
                    if (!validateField(field)) {
                        isFormValid = false;
                    }
                });
                
                if (isFormValid) {
                   
                    this.submit();
                } else {
                    
                    const firstError = document.querySelector('.error-message[style="display: block;"]');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            });
            
        
            fields.forEach(field => {
                const element = document.getElementById(field.id);
                const errorElement = document.getElementById(`${field.id}-error`);
                
                element.classList.remove('error-border');
                element.classList.remove('valid-border');
                errorElement.style.display = 'none';
            });
        });
    </script>
</body>
</html>